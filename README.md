# ğŸ§¾ Cheque Reminder WhatsApp Bot (Ballerina)

This Ballerina script automatically reads cheque data from a Google Sheet and sends timely WhatsApp reminders using the Twilio API. It distinguishes between incoming and outgoing cheques, categorizing them by due dates (today or in 3 days), and formats context-aware messages for financial reminders.

> âš™ï¸ **More than 95% of this code was generated by [WSO2 Copilot](https://ballerina.io/learn/vs-code-extension/#ballerina-copilot/)**.

---

## ğŸ“Œ Prompt Used to Generate This Code

```
/code generate code for the use-case:

Fetch cheque data from a Google Sheet that contains two sheets:
- "Cheques Received"
- "Cheques Issued"

Each sheet has the following columns:
- Cheque No.
- Payee Name
- Amount
- Bank
- Cheque Date (formatted as `d-MMM-yyyy`, e.g., `21-Apr-2025`)

Process the data as follows:

1. Read and parse data from both sheets.

2. For each sheet, identify rows based on the Cheque Date:
   - Cheques due **today**
   - Cheques due **in exactly 3 days**

3. Based on the above, generate exactly four separate messages:
   - Message 1: Cheques due **in 3 days** from the "Cheques Received" sheet.
   - Message 2: Cheques due **today** from the "Cheques Received" sheet.
   - Message 3: Cheques due **in 3 days** from the "Cheques Issued" sheet.
   - Message 4: Cheques due **today** from the "Cheques Issued" sheet.

Each message should include all matching cheques, listing:
- Cheque No.
- Payee Name
- Amount
- Bank
- Cheque Date

If there are no cheques for a specific condition, skip generating that message.

4. Send each generated message as a **separate WhatsApp message** using the Twilio API.

5. Use the placeholder phone number `+1234567890` for all WhatsApp messages.

Make sure to:
- Format each message clearly for readability on WhatsApp.
- Treat both sheets independently.
- Handle the `d-MMM-yyyy` date format accurately when comparing dates.
```

---

## ğŸš€ Features

- âœ… Connects to Google Sheets API to retrieve cheque data
- ğŸ“… Identifies cheques due *today* or *in 3 days*
- ğŸ“¤ Sends WhatsApp messages for:
  - Incoming cheques (to deposit)
  - Outgoing cheques (ensure sufficient funds)
- âœ¨ Generates smart, readable, emoji-enhanced messages
- ğŸ“² Uses Twilio WhatsApp API for notifications
- ğŸ”„ Automatically adjusts to Sri Lanka Standard Time (UTC+5:30)

---

## ğŸ§© Tech Stack

- **Ballerina** â€” Primary programming language
- **WSO2 Copilot** â€” Code generator
- **Google Sheets API** â€” Data source
- **Twilio API** â€” Messaging interface
- **Time module** â€” Date parsing and comparison

---

## ğŸ”§ Configuration

Set the following values via Ballerina's `Config.toml` or environment variables:

```toml
clientId = "<GOOGLE_CLIENT_ID>"
clientSecret = "<GOOGLE_CLIENT_SECRET>"
refreshToken = "<GOOGLE_REFRESH_TOKEN>"
spreadsheetId = "<GOOGLE_SHEET_ID>"

twilioAuthToken = "<TWILIO_AUTH_TOKEN>"
twilioAccountSid = "<TWILIO_ACCOUNT_SID>"
twilioFromNumber = "+14155238886"         # Twilio sandbox number for WhatsApp
twilioToNumber = "+1234567890"            # Your target WhatsApp number
```

---

## ğŸ“‚ Sheet Format

`Cheques Received` must follow this structure:

| Date Received | Cheque No | Issuer Name | Amount   | Bank     | Cheque Date    |
|---------------|-----------|-------------|----------|----------|---------------|
|  21-Apr-2025  | 1001      | John Doe    | LKR 5,000| ABC Bank | 21-Apr-2025   |

`Cheques Issued` must follow this structure:

| Date Received | Cheque No | Payee Name | Amount   | Bank     | Cheque Date    |
|---------------|-----------|-------------|----------|----------|---------------|
|  21-Apr-2025  | 1001      | John Doe    | LKR 5,000| ABC Bank | 21-Apr-2025   |

---

## âœ… Message Output Examples

### For *Cheques Received* due in 3 days:

```
ğŸ”” *Reminder*: Deposit Cheques Soon
--------------------------------------------------
The following cheques can be deposited in 3 days:

ğŸ§¾ Cheque No : 1001
ğŸ‘¤ Payee     : John Doe
ğŸ’° Amount    : 5000
ğŸ¦ Bank      : ABC Bank
ğŸ“… Date      : 24-Apr-2025
```

### For *Cheques Issued* due today:

```
ğŸš¨ *Urgent*: Funds Required for Issued Cheques Today
--------------------------------------------------
Ensure your bank has enough funds for these issued cheques today:

ğŸ§¾ Cheque No : 2002
ğŸ‘¤ Payee     : Jane Smith
ğŸ’° Amount    : 7500
ğŸ¦ Bank      : XYZ Bank
ğŸ“… Date      : 21-Apr-2025
```
